<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Krzysztof Żuraw">


        <title>My first personal project</title>

            <link href="https://krzysztofzuraw.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Krzysztof Żuraw Full Atom Feed" />
            <link href="https://krzysztofzuraw.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Krzysztof Żuraw RSS Feed" />
            <link href="https://krzysztofzuraw.com/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate" title="Krzysztof Żuraw Categories Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="https://krzysztofzuraw.com/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="https://krzysztofzuraw.com/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="https://krzysztofzuraw.com/theme/css/code_blocks/monokai.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="My thoughts about personal project that I made.">

        <meta name="author" content="Krzysztof Żuraw">

        <meta name="tags" content="python">

	                <meta property="og:locale" content="en_US.utf8">
		<meta property="og:site_name" content="Krzysztof Żuraw">

	<meta property="og:type" content="article">
            <meta property="article:author" content="Krzysztof Żuraw" >
	<meta property="og:url" content="https://krzysztofzuraw.com/blog/2016/my-first-personal-project.html">
	<meta property="og:title" content="My first personal project">
	<meta property="article:published_time" content="2016-05-14 10:20:00+02:00">
            <meta property="og:description" content="My thoughts about personal project that I made.">

            <meta property="og:image" content="https://krzysztofzuraw.com//images/covers/personal.jpg">
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:image" content="/images/covers/personal.jpg">
        <meta name="twitter:site" content="@krzysztof_zuraw" />
        <meta name="twitter:title" content="My first personal project" />
            <meta name="twitter:image" content="https://krzysztofzuraw.com//images/covers/personal.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://krzysztofzuraw.com/">Krzysztof Żuraw</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                        <li><a href="/pages/about.html">About</a></li>
                        <li><a href="/archives.html">Archive</a></li>
                        <li><a href="/tags.html">Tags</a></li>
                        <li><a href="http://feeds.feedburner.com/krzysztofzuraw">RSS Feed</a></li>
                        <li><a href="https://feedburner.google.com/fb/a/mailverify?uri=krzysztofzuraw&amp;loc=en_US">Email Updates</a></li>


                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/images/covers/personal.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 >My first personal project</h1>
                        <span class="meta">Posted on Sat 14 May 2016
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <!-- TOC -->

    <article>
        <p><strong>Hi, today I wanted to share my thoughts about project that I made called</strong>
<a class="reference external" href="https://github.com/krzysztofzuraw/histmag_to_kindle">histmag to kindle</a>.</p>
<div class="section" id="why">
<h2>Why?</h2>
<p>I really enjoy reading historical articles over the internet. Very good source
of such writings in polish is <a class="reference external" href="http://histmag.org/">histmag</a>. One problem is
that articles are divided into sub-pages which don't work well while I save them
to read later. Then when I'm onto reading I send my read it later articles to kindle.
To bypass such inconvenience I started adding every subpage manually
to my queue in pocket. As a step into programming path I decided to code my own
crawler to crawl through the website and then send the neatly prepared mobi file to my
kindle.</p>
</div>
<div class="section" id="what-i-learned">
<h2>What I learned?</h2>
<p>After I made my mind I have to choose between many crawling tools available in
python like: <a class="reference external" href="http://scrapy.org/">scrapy</a>, <a class="reference external" href="https://www.crummy.com/software/BeautifulSoup/">beautifulsoup</a> or
<a class="reference external" href="http://lxml.de/">lxml</a>.</p>
<p>I have chosen lxml because it was new to me and I really enjoy working with
new things. So after reading documentation about lxml I found out that most
of <cite>scraping</cite> is done via <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/XPath">XPATH</a>.</p>
<p>Syntax and how to use XPATH is for another post, but I end up with very long queries like:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">parsed_page</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;{root}//child::p[not(contains(@class, &quot;article-tags&quot;)) &#39;</span>
                                   <span class="s1">&#39;and not(contains(@class, &quot;article-info&quot;))] &#39;</span>
                                   <span class="s1">&#39;| {root}//a[contains(@href, &quot;author&quot;)]&#39;</span>
                                   <span class="s1">&#39;| {root}//em &#39;</span>
                                   <span class="s1">&#39;| {root}//img &#39;</span>
                                   <span class="s1">&#39;| {root}//span&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xpath_root</span><span class="p">)):</span>
</pre></div>
<p>As you can see I take elements that are not paragraphs with class <tt class="docutils literal"><span class="pre">article-tags</span></tt> and <tt class="docutils literal"><span class="pre">article-info</span></tt>. Moreover
I pull out the author and <tt class="docutils literal">em</tt> and <tt class="docutils literal">img</tt> tags with contents.</p>
<p>What did I learn about lxml? I really enjoyed using XPATH which is easily provided by this library. I also was able to get
python representation of html object retrieved by XPATH. What I don't like is that sometimes installing lxml can cause
memory problems as well as you need to install some packages first (system wide).</p>
<p>Another thing that I try was TDD (Test Driven Development). I have used in on code dojo before but no in <em>real</em>
project. The first thing that I learned was to use TDD only for production code- I was trying to test code that
supposes to be playground and I wasn't able to do this. But after designing how it suppose to work, TDD actually
helps. Thanks to that method I have to create such small functions or classes that they will be easily testable.
Moreover, I have a lot html in test because it is a web crawler so I created a <em>mocked</em> web pages to be the same
as real one. What is more test allows me to change my code and see if there is any place that my program is broken.</p>
<p>After development, I use my test in <a class="reference external" href="https://pypi.python.org/pypi/tox">tox</a>. For using tox I change a bit imports
and some pieces of code to let the test be run in a proper way.
Learning how to organize imports to let package be installable from setup.py was another new experience.</p>
<p>After parsing html I wanted to generate my own html document with all subpages into. At first, I used <a class="reference external" href="https://github.com/Knio/dominate">dominate</a> library but I then I switched to <a class="reference external" href="http://py.readthedocs.io/en/latest/xml.html">pyxml</a>. Mainly because I need something
easy and simple to just generate html. Pyxml API is very simple:</p>
<div class="highlight"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">html</span><span class="p">(</span>
    <span class="n">html</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
        <span class="c1"># python don&#39;t allow keyword args with hypens</span>
        <span class="n">html</span><span class="o">.</span><span class="n">meta</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=utf-8&quot;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;http-equiv&quot;</span><span class="p">:</span> <span class="s2">&quot;Content-Type&quot;</span><span class="p">}),</span>
        <span class="n">_get_tile</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">pages</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="n">html</span><span class="o">.</span><span class="n">body</span><span class="p">(</span>
        <span class="n">html</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">_generate_body</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">pages</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">),</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;article&#39;</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
<p>This piece of code actually will generate the whole html.</p>
<p>Then thanks to amazon I can just send html to my kindle and it will be automatically converted to mobi. The one problem with this
approach is that I cannot send the whole html with images so I have to generate mobi locally and send it to the ebook reader. I did this
by calling <a class="reference external" href="http://www.amazon.com/gp/feature.html?docId=1000765211">kindlegen</a>. It works really good but the license stays
that I can't redistribute it so enduser have to download it manually. Whole html file with pictures was in the same directory, then
I called kindlegen on html file:</p>
<div class="highlight"><pre><span></span><span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;KINDLEGEN&#39;</span><span class="p">),</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">html_dir_path</span><span class="p">,</span> <span class="s1">&#39;histmag.html&#39;</span><span class="p">),</span>
        <span class="s1">&#39;-o&#39;</span><span class="p">,</span>
        <span class="n">output</span>
    <span class="p">],</span>
    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span>
<span class="p">)</span>
</pre></div>
<p>To call external binay I used <a class="reference external" href="https://docs.python.org/3/library/subprocess.html">subprocess</a> library.</p>
<p>Lastly, I send a simple email via <a class="reference external" href="https://www.mailgun.com/">mailgun</a>. It could be done in better way with
my own domain, because right now enduser has to provide <tt class="docutils literal">mailgun_api_key</tt> and <tt class="docutils literal">email_server</tt> for sending messages
to kindle.</p>
</div>
<div class="section" id="what-can-be-done-differenlty">
<h2>What can be done differenlty?</h2>
<p>I believe that whole crawling mechanism should be redesigned due to being synchronous. Moreover, next time I
will try beautifulsoup for getting particular elements from html tree. I would also like to try generating
epub file instead of mobi.</p>
<p>Cover picture by <a class="reference external" href="https://pixabay.com/pl/users/Unsplash-242387/">Unsplash</a> under <a class="reference external" href="https://creativecommons.org/publicdomain/zero/1.0/deed.en">CC0 Public Domain</a>.</p>
</div>

    </article>

        <div class="tags">
            <p>tags: <a href="https://krzysztofzuraw.com/tag/python.html">python</a>, </p>
        </div>
        <p>If you find this blog post interesting please share:</p>
        <div class="addthis_sharing_toolbox"></div>
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57a7802d9a259bbe"></script>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'krzysztofzuraw';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//krzysztofzuraw.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/krzysztof_zuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/krzysztofzuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="mailto:krzysztof.zuraw@gmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://pl.linkedin.com/in/krzysztofzuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
    This site use cookies for disqus and google analitics.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://krzysztofzuraw.com/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://krzysztofzuraw.com/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="https://krzysztofzuraw.com/theme/js/clean-blog.min.js"></script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72188452-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'krzysztofzuraw';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>