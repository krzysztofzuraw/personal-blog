<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Krzysztof Żuraw">


        <title>Design by contract in python- part one</title>

            <link href="https://krzysztofzuraw.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Krzysztof Żuraw Full Atom Feed" />
            <link href="https://krzysztofzuraw.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Krzysztof Żuraw RSS Feed" />
            <link href="https://krzysztofzuraw.com/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate" title="Krzysztof Żuraw Categories Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="https://krzysztofzuraw.com/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="https://krzysztofzuraw.com/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="https://krzysztofzuraw.com/theme/css/code_blocks/monokai.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Short description of libraries used to implement design by contract in python.">

        <meta name="author" content="Krzysztof Żuraw">

        <meta name="tags" content="python">

	                <meta property="og:locale" content="en_US.utf8">
		<meta property="og:site_name" content="Krzysztof Żuraw">

	<meta property="og:type" content="article">
            <meta property="article:author" content="Krzysztof Żuraw" >
	<meta property="og:url" content="https://krzysztofzuraw.com/blog/2016/design-by-contract-in-python-part-one.html">
	<meta property="og:title" content="Design by contract in python- part one">
	<meta property="article:published_time" content="2016-07-16 10:00:00+02:00">
            <meta property="og:description" content="Short description of libraries used to implement design by contract in python.">

            <meta property="og:image" content="https://krzysztofzuraw.com//images/covers/contract.jpg">
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:image" content="/images/covers/contract.jpg">
        <meta name="twitter:site" content="@krzysztof_zuraw" />
        <meta name="twitter:title" content="Design by contract in python- part one" />
            <meta name="twitter:image" content="https://krzysztofzuraw.com//images/covers/contract.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://krzysztofzuraw.com/">Krzysztof Żuraw</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                        <li><a href="/pages/about.html">About</a></li>
                        <li><a href="/archives.html">Archive</a></li>
                        <li><a href="/tags.html">Tags</a></li>
                        <li><a href="http://feeds.feedburner.com/krzysztofzuraw">RSS Feed</a></li>
                        <li><a href="https://feedburner.google.com/fb/a/mailverify?uri=krzysztofzuraw&amp;loc=en_US">Email Updates</a></li>


                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/images/covers/contract.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 >Design by contract in python- part one</h1>
                        <span class="meta">Posted on Sat 16 July 2016
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <!-- TOC -->

    <article>
        <p><strong>What exactly is design by contract? What is good and what is bad in this approach?
What are python libraries that provide support for such design? You can find all
these answers in this blog series about contracts.</strong></p>
<p>Recently I read a <a class="reference external" href="https://pragprog.com/book/tpp/the-pragmatic-programmer">Pragmatic Programmer</a>.
In this book there is a chapter 21: <cite>Design by Contract</cite> that stays:</p>
<blockquote>
It is a simple yet powerful technique that focuses on documenting (and agreeing to) the rights
and responibilites of software mdoules to ensure program correctness.</blockquote>
<p>How to achieve this? There are 3 basic expectations of any given function/class:</p>
<ol class="arabic simple">
<li><strong>Preconditions</strong>: What are function requirements in order to be called</li>
<li><strong>Postconditions</strong>: What is class guaranteed to do</li>
<li><strong>Class invariants</strong>: Conditions that are true after execution of function/class</li>
</ol>
<p>Let's move to the actual implementation in python. I found at least 3 libraries that are made to
provide help while using contracts. I'll start from the first one: <a class="reference external" href="https://pypi.python.org/pypi/PyContracts">py.contracts</a>.</p>
<p>To demonstrate how to use this library I'll reuse my old code from
<a class="reference external" href="http://krzysztofzuraw.com/blog/2016/ports-and-adapters-in-python-part-three.html">ports and apdaters series</a>.
There is a reddit port:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExternalAPIPort</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adapter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">adapter</span>

    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapter</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
<p>I want to make sure that query is a string. What is more, I want this string not to be empty.
And I return <tt class="docutils literal">search</tt> should return nested list.
How do I contract it using py.contracts?</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">contract</span>

<span class="c1"># class ExternalAPIPort here</span>

<span class="nd">@contract</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s1">&#39;str[&gt;0]&#39;</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="s1">&#39;list(str)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</pre></div>
<p>And messing around with wrong returns values gives you following errors:</p>
<div class="highlight"><pre><span></span>contracts.interface.ContractNotRespected: Breach for return value of ExternalAPIPort:search().
Expected a list, got &#39;int&#39;.
checking: list(str)   for value: Instance of &lt;class &#39;int&#39;&gt;: 1
</pre></div>
<p>Right now I knew because of contract that this <tt class="docutils literal">search</tt> method will take query
parameter which has to be string with length more than 0 (precondition) and returns list of strings (postcondition).</p>
<p>The same can be accomplished with metaclasses:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">contract</span><span class="p">,</span> <span class="n">ContractsMeta</span>

<span class="k">class</span> <span class="nc">BasePort</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="vm">__metaclass__</span> <span class="o">=</span> <span class="n">ContractsMeta</span>

    <span class="nd">@abstractmethod</span>
    <span class="nd">@contract</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s1">&#39;str[&gt;0]&#39;</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="s1">&#39;list(str)&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ExternalAPIPort</span><span class="p">(</span><span class="n">BasePort</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapter</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
<p>This code will work for python 2. If you want to use <tt class="docutils literal">ContractsMeta</tt> with python
3 you have to use function <tt class="docutils literal">with_metaclass</tt> or simply write
<tt class="docutils literal">BasePort(object, metaclass=ContractsMeta)</tt>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">contract</span><span class="p">,</span> <span class="n">ContractsMeta</span><span class="p">,</span> <span class="n">with_metaclass</span>

  <span class="k">class</span> <span class="nc">BasePort</span><span class="p">(</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">ContractsMeta</span><span class="p">,</span> <span class="nb">object</span><span class="p">)):</span>

    <span class="nd">@abstractmethod</span>
    <span class="nd">@contract</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s1">&#39;str[&gt;0]&#39;</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="s1">&#39;list(str)&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
<p>What I like in this library is a possibility to disable contracts by calling
<tt class="docutils literal">contracts.disable_all()</tt> or using <tt class="docutils literal">DISABLE_CONTRACTS</tt> environmental variable.</p>
<p>Unfortunately, py.contracts doesn't provide way to use invariants but you always
can use <tt class="docutils literal">assert</tt>.</p>
<p>That's all for this blog post! Feel free to comment and in next week I will look
into another contract library in python.</p>
<div class="section" id="other-blog-posts-in-this-series">
<h2>Other blog posts in this series:</h2>
<ul class="simple">
<li><a class="reference external" href="https://krzysztofzuraw.com/blog/2016/design-by-contract-in-python-part-two.html">Design by contract in python- part two</a></li>
<li><a class="reference external" href="https://krzysztofzuraw.com/blog/2016/design-by-contract-in-python-part-three.html">Design by contract in python- part three</a></li>
</ul>
<p>Edits (01.08.2016):</p>
<ul class="simple">
<li>Add additional method for invoking metaclass in py.contracts (thanks to <a class="reference external" href="https://www.reddit.com/user/mm_ma_ma">mm_ma_ma</a>)</li>
<li>Add link to other posts with same series (thanks to <a class="reference external" href="https://www.reddit.com/user/alb1">alb1</a>)</li>
</ul>
<p>Cover image under <a class="reference external" href="https://creativecommons.org/publicdomain/zero/1.0/deed.en">CC0</a>.</p>
</div>

    </article>

        <div class="tags">
            <p>tags: <a href="https://krzysztofzuraw.com/tag/python.html">python</a>, </p>
        </div>
        <p>If you find this blog post interesting please share:</p>
        <div class="addthis_sharing_toolbox"></div>
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57a7802d9a259bbe"></script>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'krzysztofzuraw';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//krzysztofzuraw.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/krzysztof_zuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/krzysztofzuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="mailto:krzysztof.zuraw@gmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://pl.linkedin.com/in/krzysztofzuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
    This site use cookies for disqus and google analitics.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://krzysztofzuraw.com/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://krzysztofzuraw.com/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="https://krzysztofzuraw.com/theme/js/clean-blog.min.js"></script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72188452-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'krzysztofzuraw';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>