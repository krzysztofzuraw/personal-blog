<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Krzysztof Żuraw">


        <title>Automatic blog deployment with TravisCI</title>

            <link href="https://krzysztofzuraw.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Krzysztof Żuraw Full Atom Feed" />
            <link href="https://krzysztofzuraw.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Krzysztof Żuraw RSS Feed" />
            <link href="https://krzysztofzuraw.com/feeds/blog.atom.xml" type="application/atom+xml" rel="alternate" title="Krzysztof Żuraw Categories Atom Feed" />
        <!-- Bootstrap Core CSS -->
        <link href="https://krzysztofzuraw.com/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="https://krzysztofzuraw.com/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="https://krzysztofzuraw.com/theme/css/code_blocks/monokai.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="First part of series about Django application with Celery and RabbitMQ.">

        <meta name="author" content="Krzysztof Żuraw">

        <meta name="tags" content="pelican">

	                <meta property="og:locale" content="en_US.utf8">
		<meta property="og:site_name" content="Krzysztof Żuraw">

	<meta property="og:type" content="article">
            <meta property="article:author" content="Krzysztof Żuraw" >
	<meta property="og:url" content="https://krzysztofzuraw.com/blog/2016/automatic-blog-deployment-with-travis.html">
	<meta property="og:title" content="Automatic blog deployment with TravisCI">
	<meta property="article:published_time" content="2016-04-09 10:20:00+02:00">
            <meta property="og:description" content="First part of series about Django application with Celery and RabbitMQ.">

            <meta property="og:image" content="https://krzysztofzuraw.com//images/covers/pelican.jpg">
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:image" content="/images/covers/pelican.jpg">
        <meta name="twitter:site" content="@krzysztof_zuraw" />
        <meta name="twitter:title" content="Automatic blog deployment with TravisCI" />
            <meta name="twitter:image" content="https://krzysztofzuraw.com//images/covers/pelican.jpg">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://krzysztofzuraw.com/">Krzysztof Żuraw</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                        <li><a href="/pages/about.html">About</a></li>
                        <li><a href="/archives.html">Archive</a></li>
                        <li><a href="/tags.html">Tags</a></li>
                        <li><a href="http://feeds.feedburner.com/krzysztofzuraw">RSS Feed</a></li>
                        <li><a href="https://feedburner.google.com/fb/a/mailverify?uri=krzysztofzuraw&amp;loc=en_US">Email Updates</a></li>


                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/images/covers/pelican.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1 >Automatic blog deployment with TravisCI</h1>
                        <span class="meta">Posted on Sat 09 April 2016
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <!-- TOC -->

    <article>
        <p><strong>Hello! Today I will write about how to automate blog deployment using</strong> <a class="reference external" href="https://travis-ci.org/">TravisCI</a> <strong>with bash scripts</strong>.</p>
<p>When I first started writing blog using pelican my workflow look as follows:</p>
<ol class="arabic simple">
<li>I open one terminal window and go under <tt class="docutils literal">output</tt> just for serving static files using <tt class="docutils literal">python <span class="pre">-m</span> SimpleHTTPServer</tt></li>
<li>Then I open another terminal and if I wanted to generate my changes in the post I have to do <tt class="docutils literal">pelican content <span class="pre">-s</span> pelicanconf.py <span class="pre">-t</span>&nbsp; <span class="pre">pelican-clean-blog</span></tt></li>
<li>After this I open my browser window and go to <tt class="docutils literal">127.0.0.1:8000</tt> to see my changes</li>
<li>To publish content I push it to responsible branch</li>
</ol>
<p>After some time, I know that there must be the way to automate such boring stuff. So I started looking around my pelican folder and
I found <a class="reference external" href="https://github.com/krzysztofzuraw/personal-blog/blob/master/Makefile">Makefile</a>.</p>
<p>This makefile is used to manage all these things that I am doing manually into bash script so it is perfect!</p>
<p>Let's look into content of makefile, what is worth seeing is command <tt class="docutils literal">devserver</tt>:</p>
<div class="highlight"><pre><span></span>devserver:
ifdef PORT
        <span class="k">$(</span>BASEDIR<span class="k">)</span>/develop_server.sh restart <span class="k">$(</span>PORT<span class="k">)</span>
<span class="k">else</span>
        <span class="k">$(</span>BASEDIR<span class="k">)</span>/develop_server.sh restart
endif
</pre></div>
<p>So whenever you specify <tt class="docutils literal">$(PORT)</tt> or not the same command will be used: <tt class="docutils literal">develop_server.sh restart</tt>. So what we have in <tt class="docutils literal">restart</tt>?</p>
<div class="highlight"><pre><span></span><span class="k">elif</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">&quot;restart&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
 shut_down
 start_up <span class="nv">$port</span>
</pre></div>
<p>and <tt class="docutils literal">start_up</tt>:</p>
<div class="highlight"><pre><span></span><span class="lineno"> 1 </span><span class="k">function</span> start_up<span class="o">(){</span>
<span class="lineno"> 2 </span>  <span class="nb">local</span> <span class="nv">port</span><span class="o">=</span><span class="nv">$1</span>
<span class="lineno"> 3 </span>  <span class="nb">echo</span> <span class="s2">&quot;Starting up Pelican and HTTP server&quot;</span>
<span class="lineno"> 4 </span>  <span class="nb">shift</span>
<span class="lineno"> 5 </span>  <span class="nb">echo</span> <span class="nv">$PELICANOPTS</span>
<span class="lineno"> 6 </span>  <span class="nv">$PELICAN</span> --debug --autoreload -r <span class="nv">$INPUTDIR</span> -o <span class="nv">$OUTPUTDIR</span> -s <span class="nv">$CONFFILE</span> <span class="nv">$PELICANOPTS</span> <span class="p">&amp;</span>
<span class="lineno"> 7 </span>  <span class="nv">pelican_pid</span><span class="o">=</span><span class="nv">$!</span>
<span class="lineno"> 8 </span>  <span class="nb">echo</span> <span class="nv">$pelican_pid</span> &gt; <span class="nv">$PELICAN_PID</span>
<span class="lineno"> 9 </span>  <span class="nb">cd</span> <span class="nv">$OUTPUTDIR</span>
<span class="lineno">10 </span>  <span class="nv">$PY</span> -m pelican.server <span class="nv">$port</span> <span class="p">&amp;</span>
<span class="lineno">11 </span>  <span class="nv">srv_pid</span><span class="o">=</span><span class="nv">$!</span>
<span class="lineno">12 </span>  <span class="nb">echo</span> <span class="nv">$srv_pid</span> &gt; <span class="nv">$SRV_PID</span>
<span class="lineno">13 </span>  <span class="nb">cd</span> <span class="nv">$BASEDIR</span>
<span class="lineno">14 </span>  sleep <span class="m">1</span>
<span class="lineno">15 </span>  <span class="k">if</span> ! alive <span class="nv">$pelican_pid</span> <span class="p">;</span> <span class="k">then</span>
<span class="lineno">16 </span>    <span class="nb">echo</span> <span class="s2">&quot;Pelican didn&#39;t start. Is the Pelican package installed?&quot;</span>
<span class="lineno">17 </span>    <span class="k">return</span> <span class="m">1</span>
<span class="lineno">18 </span>  <span class="k">elif</span> ! alive <span class="nv">$srv_pid</span> <span class="p">;</span> <span class="k">then</span>
<span class="lineno">19 </span>    <span class="nb">echo</span> <span class="s2">&quot;The HTTP server didn&#39;t start. Is there another service using port&quot;</span> <span class="nv">$port</span> <span class="s2">&quot;?&quot;</span>
<span class="lineno">20 </span>    <span class="k">return</span> <span class="m">1</span>
<span class="lineno">21 </span>  <span class="k">fi</span>
<span class="lineno">22 </span>  <span class="nb">echo</span> <span class="s1">&#39;Pelican and HTTP server processes now running in background.&#39;</span>
<span class="lineno">23 </span><span class="o">}</span>
</pre></div>
<p>In line 6 is normal pelican command like:</p>
<div class="highlight"><pre><span></span>pelican --debug --autoreload -r personal_blog/content -o personal_blog/output -s personal_blog/pelicanconf.py
</pre></div>
<p>Is is running pelican in debug mode with auto reload taking post content from <tt class="docutils literal">personal_blog/content</tt>. It generate
output to <tt class="docutils literal">personal_blog/output</tt> with settings from <tt class="docutils literal">personal_blog/pelicanconf.py</tt>.</p>
<p>After that script enters the <tt class="docutils literal">$OUTPUTDIR</tt> and starts the pelican server by <tt class="docutils literal">$PY <span class="pre">-m</span> pelican.server $port</tt>.</p>
<p>But what if I wanted to publish my work into GitHub Pages? There is command for that in <tt class="docutils literal">Makefile</tt></p>
<div class="highlight"><pre><span></span>github: publish
       ghp-import -m <span class="s2">&quot;Generate Pelican site&quot;</span> -b <span class="k">$(</span>GITHUB_PAGES_BRANCH<span class="k">)</span> <span class="k">$(</span>OUTPUTDIR<span class="k">)</span>
       git push origin <span class="k">$(</span>GITHUB_PAGES_BRANCH<span class="k">)</span>
</pre></div>
<p>It is using <a class="reference external" href="https://github.com/davisp/ghp-import">ghp-import</a>. <tt class="docutils literal"><span class="pre">Ghp-import</span></tt> is python application that allows
pushing content to GitHub branches. Why is that important? The GitHub pages are organized in that way:</p>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="36%" />
<col width="19%" />
</colgroup>
<tbody valign="top">
<tr><td>Type of site</td>
<td>Page address</td>
<td>Publishing branch</td>
</tr>
<tr><td>User Pages site</td>
<td><tt class="docutils literal">username.github.io</tt></td>
<td>master</td>
</tr>
<tr><td>Project Pages site owned by a user account</td>
<td><tt class="docutils literal">username.github.io/projectname</tt></td>
<td>gh-pages</td>
</tr>
</tbody>
</table>
<p><em>Table taken from</em> <a class="reference external" href="https://help.github.com/articles/user-organization-and-project-pages/">GitHub Pages help</a>.</p>
<p>As you can see to publish content on GitHub Pages  you have to push either to master and you can see is under <tt class="docutils literal">krzysztofzuraw.github.io</tt>
or to gh-pages and go to <tt class="docutils literal"><span class="pre">krzysztofzuraw.github.io/personal-blog</span></tt>. As I wanted building process of my blog to be automated I choose
second option: on master I will have all settings and content that is be used to render HTML will be on gh-pages branch.</p>
<p>So to automate I need TravisCI. After connecting service to your GitHub account, let's enable it for given project:</p>
<img alt="" src="/images/travis1.png" />
<p>And on the next screen enable repository for what you want to trigger Travis. After this click on wheel next to the name of the repo. In next page setup two environmental variables:</p>
<img alt="" src="/images/travis2.png" />
<p><tt class="docutils literal">GH_TOKEN</tt> is your token generated from this <a class="reference external" href="https://github.com/settings/tokens">page</a>. Click there on <tt class="docutils literal">Generate new token</tt> and
in next screen make sure you add token description and scope for public_repo:</p>
<img alt="" src="/images/travis3.png" />
<p>After generating token add it to Travis. The another variable in Travis <tt class="docutils literal">TRAVIS_REPO_SLUG</tt> is in the form of <tt class="docutils literal"><span class="pre">username/project-name</span></tt> so in my case it was <tt class="docutils literal"><span class="pre">krzysztofzuraw/personal-blog</span></tt>. After setting up these variables add the following file <tt class="docutils literal">.travis.yml</tt> to the main root of your
pelican blog project with following content:</p>
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">language</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="l l-Scalar l-Scalar-Plain">branches</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">only</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="l l-Scalar l-Scalar-Plain">install</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pip install pelican</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pip install ghp-import</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pip install pelican_gist</span>
<span class="l l-Scalar l-Scalar-Plain">script</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">make publish github</span>
</pre></div>
<p>It tells Travis to install pelican, ghp-import and pelican_gist (plugin for gists in pelican) and then it runs <tt class="docutils literal">make publish github</tt>.</p>
<p>To make it work I need to change one thing in <tt class="docutils literal">Makefile</tt>:</p>
<div class="highlight"><pre><span></span>github: publish
        ghp-import -m <span class="s2">&quot;Generate Pelican site&quot;</span> -b <span class="k">$(</span>GITHUB_PAGES_BRANCH<span class="k">)</span> <span class="k">$(</span>OUTPUTDIR<span class="k">)</span>
        @git push -fq https://<span class="si">${</span><span class="nv">GH_TOKEN</span><span class="si">}</span>@github.com/<span class="k">$(</span>TRAVIS_REPO_SLUG<span class="k">)</span>.git <span class="k">$(</span>GITHUB_PAGES_BRANCH<span class="k">)</span>
</pre></div>
<p>The change is that I push to repo using <tt class="docutils literal">GH_TOKEN</tt> not username so Travis is able to do it.</p>
<p>So right now when I push my commits to master branch the Travis starts building my blog!</p>
<div class="section" id="references">
<h2>References:</h2>
<ol class="arabic simple">
<li><a class="reference external" href="http://blog.mathieu-leplatre.info/publish-your-pelican-blog-on-github-pages-via-travis-ci.html">Publish your Pelican blog on Github pages via Travis-CI</a>.</li>
</ol>
<p>Cover image by <a class="reference external" href="https://www.flickr.com/photos/manjithkaini/">Manjith Kainickara</a> under <a class="reference external" href="https://creativecommons.org/licenses/by-sa/2.0/">CC BY-SA 2.0</a>.</p>
</div>

    </article>

        <div class="tags">
            <p>tags: <a href="https://krzysztofzuraw.com/tag/pelican.html">pelican</a>, </p>
        </div>
        <p>If you find this blog post interesting please share:</p>
        <div class="addthis_sharing_toolbox"></div>
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57a7802d9a259bbe"></script>

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'krzysztofzuraw';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//krzysztofzuraw.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/krzysztof_zuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/krzysztofzuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="mailto:krzysztof.zuraw@gmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://pl.linkedin.com/in/krzysztofzuraw">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>.
    This site use cookies for disqus and google analitics.
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://krzysztofzuraw.com/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://krzysztofzuraw.com/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="https://krzysztofzuraw.com/theme/js/clean-blog.min.js"></script>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72188452-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'krzysztofzuraw';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>